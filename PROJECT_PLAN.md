# 📋 Agent ROS Bridge — 完整项目计划表

**创建日期：** 2026-02-28  
**当前版本：** v0.5.0  
**审计报告：** 参见 memory/daily/2026-02-28.md

---

## 🎯 项目目标回顾（来自 ROADMAP）

### v0.5.0 目标（已完成）
- ✅ 完整的 AI 框架集成（LangChain、AutoGPT、MCP）
- ✅ AgentMemory、SafetyManager、ToolDiscovery
- ✅ 实时 Web 仪表盘
- ✅ 15+ 集成测试
- ✅ 发布至 PyPI 和 GitHub

### v0.6.0 目标（计划中）
- 📋 增强仪表盘（Grafana 集成）
- 📋 多智能体编排（舰队级协调）
- 📋 示教学习（记录和回放技能）
- 📋 云集成（托管服务选项）
- 📋 Helm Chart（Kubernetes 部署）
- 📋 Terraform 模块（AWS/GCP/Azure）
- 📋 监控堆栈（Grafana 仪表盘、告警）
- 📋 备份/恢复（数据持久化）

### v1.0.0 目标（未来）
- 📋 90%+ 测试覆盖率
- 📋 完整 API 稳定性
- 📋 通过安全审计
- 📋 生产部署文档
- 📋 建立社区

---

## 🔍 当前状态审计总结

### ✅ 强项
| 维度 | 状态 | 评分 |
|------|------|------|
| 代码质量 | 结构清晰，类型注解完整 | ⭐⭐⭐⭐⭐ |
| AI 集成 | 7 个模块全部存在且功能完整 | ⭐⭐⭐⭐⭐ |
| 文档完整性 | README、CHANGELOG、ROADMAP 齐全 | ⭐⭐⭐⭐⭐ |
| 核心功能测试 | 222/270 通过（82%）| ⭐⭐⭐⭐☆ |
| CI/CD 基础设施 | GitHub Actions 完整 | ⭐⭐⭐⭐⭐ |

### ⚠️ 问题
| 问题 | 严重性 | 影响 |
|------|--------|------|
| 48 个测试失败 | 中 | 主要因依赖缺失（Redis/ROS2/websockets）|
| Git 分支未合并 | 高 | `test-phase-1` → `main` 待合并 |
| 未提交测试文件 | 中 | 5 个单元测试文件未跟踪 |
| 测试环境不一致 | 中 | 本地与 CI 环境差异导致失败 |
| gRPC/ROS 实现未完成 | 中 | README 标记为 "In Progress" |

---

## 🏗️ 测试驱动开发（TDD）要求

### TDD 原则对齐
1. **红-绿-重构循环**
   - 🔴 编写失败的测试
   - 🟢 编写最少代码使测试通过
   - 🔵 重构代码，保持测试通过

2. **当前差距分析**
   - ❌ 部分功能先实现后补测试
   - ❌ 集成测试依赖外部服务
   - ✅ 单元测试覆盖率良好（核心功能 100%）
   - ❌ 缺少端到端测试

### 测试策略改进

#### Phase 1: 修复现有测试（Week 1-2）
```
目标: 270/270 测试通过
```

| 测试类别 | 当前状态 | 修复方案 |
|----------|----------|----------|
| 单元测试 | 222/270 通过 | 标记依赖缺失的测试为 skipif |
| Redis 测试 | 7 失败 | 添加 `@pytest.mark.skipif(no_redis)` |
| ROS2 测试 | 9 失败 | 添加 `@pytest.mark.skipif(no_ros2)` |
| WebSocket 测试 | 11 失败 | 修复异步 mocking |
| 集成测试 | 9 失败 | 使用测试容器或 Mock |

#### Phase 2: 提高覆盖率（Week 3-4）
```
目标: 90%+ 代码覆盖率
```

| 模块 | 当前覆盖 | 目标 | 优先级 |
|------|----------|------|--------|
| gateway_v2/core.py | ? | 90% | P0 |
| integrations/*.py | ? | 85% | P1 |
| fleet/orchestrator.py | ? | 80% | P2 |
| transports/grpc*.py | ? | 70% | P2 |

#### Phase 3: 端到端测试（Week 5-6）
```
目标: 完整的用户流程测试
```

| 场景 | 测试内容 |
|------|----------|
| 模拟机器人完整流程 | 连接 → 鉴权 → 命令 → 响应 |
| LangChain 集成 | 工具发现 → 执行 → 内存 |
| MCP 服务器 | 初始化 → 工具列表 → 调用 |
| 舰队协调 | 多机器人注册 → 任务分配 |

---

## 🚀 CI/CD 流水线要求

### 当前状态
- ✅ GitHub Actions 工作流存在
- ✅ 多 Python 版本测试（3.10/3.11/3.12）
- ✅ Docker 构建测试
- ✅ PyPI 自动发布
- ✅ CodeQL 安全扫描
- ✅ Dependabot 自动合并

### 改进计划

#### 1. 预提交阶段（Pre-commit）
```yaml
当前: .pre-commit-config.yaml 存在
改进:
  - 添加 pytest-smoke（快速冒烟测试）
  - 添加 mypy --strict
  - 添加 bandit 安全扫描
  - 添加 commitizen 提交规范检查
```

#### 2. CI 阶段（Pull Request）
```yaml
当前工作流: ci.yml, ci-auto-test.yml
改进:
  - 分离"快速测试"vs"完整测试"
  - 添加测试环境矩阵（Ubuntu/macOS/Windows）
  - 添加 ROS2 环境测试（Docker 容器）
  - 添加性能基准测试
```

#### 3. CD 阶段（Release）
```yaml
当前工作流: release.yml
改进:
  - 添加语义化版本检查
  - 添加 CHANGELOG 验证
  - 添加 Docker Hub 多架构推送
  - 添加 GitHub Release 自动生成
  - 添加 Homebrew Formula 更新
```

---

## 📅 完整实施计划

### Phase 0: 立即行动（Week 0）
**目标：恢复主分支健康状态**

| 任务 | 负责人 | 预估时间 | 验收标准 |
|------|--------|----------|----------|
| 合并 test-phase-1 → main | webthree549 | 1h | PR 合并，无冲突 |
| 提交未跟踪的测试文件 | webthree549 | 30m | 5 个文件加入版本控制 |
| 标记依赖缺失的测试 | webthree549 | 2h | 48 个失败测试变为 skip |
| 验证 CI 通过 | webthree549 | 1h | GitHub Actions 全绿 |

### Phase 1: 测试修复与基础设施（Week 1-2）
**目标：270/270 测试通过**

| 任务 | 优先级 | 详细内容 |
|------|--------|----------|
| T1.1 修复测试标记 | P0 | 为 Redis/ROS2/WebSocket 测试添加 `@pytest.mark.skipif` |
| T1.2 Mock 外部依赖 | P0 | 使用 `unittest.mock` 替代真实服务 |
| T1.3 修复异步测试 | P0 | 修复 WebSocket 传输层 async mocking |
| T1.4 集成测试容器 | P1 | 使用 `testcontainers` 启动 Redis 测试容器 |
| T1.5 CI 环境对齐 | P1 | 确保本地和 CI 环境一致 |

### Phase 2: 功能补全（Week 3-5）
**目标：完成 README 中标记 "In Progress" 的功能**

| 功能 | 优先级 | 状态 | 完成标准 |
|------|--------|------|----------|
| F2.1 gRPC 传输完成 | P1 | 🔧 In Progress | proto 定义、服务注册、端到端测试 |
| F2.2 ROS2 连接器完成 | P1 | 🔧 In Progress | publish/subscribe、消息转换 |
| F2.3 ROS1 连接器完成 | P2 | 🔧 In Progress | 端到端测试通过 |
| F2.4 Tool Discovery 完成 | P2 | 🔧 In Progress | ROS 自省实现 |

### Phase 3: 测试覆盖率提升（Week 6-8）
**目标：90%+ 代码覆盖率**

| 模块 | 当前覆盖 | 目标 | 测试类型 |
|------|----------|------|----------|
| T3.1 gateway_v2/core | ? | 90% | 单元 + 集成 |
| T3.2 integrations/* | ? | 85% | 单元 + Mock |
| T3.3 fleet/orchestrator | ? | 80% | 集成 |
| T3.4 examples/ | 0% | 60% | 端到端 |

### Phase 4: CI/CD 优化（Week 9-10）
**目标：生产级流水线**

| 任务 | 优先级 | 详细内容 |
|------|--------|----------|
| C4.1 预提交增强 | P1 | 添加 smoke 测试、严格类型检查 |
| C4.2 CI 矩阵扩展 | P2 | macOS、Windows、ROS2 容器测试 |
| C4.3 性能基准 | P2 | 添加 pytest-benchmark，追踪性能回归 |
| C4.4 发布自动化 | P1 | 语义化版本、自动生成 Release Notes |
| C4.5 安全扫描 | P1 | 添加 Snyk、Trivy 镜像扫描 |

### Phase 5: v0.6.0 功能开发（Week 11-20）
**目标：企业级功能**

| 功能 | 优先级 | 依赖 | 估算工时 |
|------|--------|------|----------|
| F5.1 Helm Chart | P1 | K8s 知识 | 2 weeks |
| F5.2 Terraform 模块 | P2 | AWS/GCP/Azure | 2 weeks |
| F5.3 Grafana 集成 | P1 | Prometheus 知识 | 1 week |
| F5.4 多智能体编排 | P2 | fleet 扩展 | 3 weeks |
| F5.5 示教学习 | P3 | ML 知识 | 4 weeks |
| F5.6 云集成 | P3 | 云服务 API | 4 weeks |
| F5.7 备份/恢复 | P2 | 存储设计 | 1 week |

### Phase 6: v1.0.0 稳定化（Week 21-26）
**目标：企业级发布**

| 任务 | 优先级 | 验收标准 |
|------|--------|----------|
| F6.1 安全审计 | P0 | 第三方安全审计通过 |
| F6.2 性能测试 | P0 | 延迟 <10ms，吞吐量 >1000 msg/s |
| F6.3 负载测试 | P0 | 支持 100+ 并发机器人 |
| F6.4 文档完善 | P0 | 完整 API 文档、部署指南 |
| F6.5 社区建设 | P1 | Discord/论坛、贡献指南 |

---

## 📊 关键里程碑

| 里程碑 | 日期 | 目标 |
|--------|------|------|
| M0 | 2026-02-28 | 主分支恢复健康（本日） |
| M1 | 2026-03-07 | 270/270 测试通过 |
| M2 | 2026-03-21 | gRPC + ROS2 完成 |
| M3 | 2026-04-04 | 90%+ 测试覆盖率 |
| M4 | 2026-04-18 | CI/CD 生产就绪 |
| M5 | 2026-06-20 | v0.6.0 发布 |
| M6 | 2026-08-01 | v1.0.0 稳定版 |

---

## 🎯 本周行动计划

### 今天（2026-02-28）
- [ ] 合并 `test-phase-1` → `main`
- [ ] 提交 5 个未跟踪的测试文件
- [ ] 为 Redis/ROS2 测试添加 skipif 标记

### 明天（2026-03-01）
- [ ] 修复 WebSocket 异步测试
- [ ] 验证 CI 全绿
- [ ] 更新 ROADMAP 进度

### 本周剩余
- [ ] 完成所有测试修复
- [ ] 撰写测试策略文档
- [ ] 规划 v0.6.0 详细任务

---

## 📈 成功指标

| 指标 | 当前 | 目标 | 测量方式 |
|------|------|------|----------|
| 测试通过率 | 82% | 100% | pytest |
| 代码覆盖率 | ? | 90% | pytest-cov |
| CI 构建时间 | ? | <5 min | GitHub Actions |
| 发布频率 | 手动 | 自动化 | 语义化版本 |
| 文档完整性 | 80% | 100% | 覆盖率工具 |

---

**计划负责人：** webthree549  
**审核日期：** 每周六  
**更新频率：** 每次发布或重大变更

---

*生成时间：2026-02-28 07:05 PST*
