#!/bin/bash
# Fix TCP server connection issues - restart with debugging

echo "ðŸ”„ Restarting TCP server with debugging..."

# Kill existing TCP server
docker exec ros2-jazzy-bridge pkill -f "openclaw_tcp_server" 2>/dev/null || true
sleep 2

# Start TCP server in foreground for debugging
echo "Starting TCP server (this will show live output)..."
echo "Press Ctrl+C to stop"
echo ""

docker exec ros2-jazzy-bridge bash -c "
    cd /app && 
    source /opt/ros/jazzy/setup.bash && 
    source install/setup.bash 2>/dev/null || true &&
    export MOCK_MODE=true &&
    export PYTHONUNBUFFERED=1 &&
    python3 /app/openclaw_ros_bridge/communication/openclaw_tcp_server.py 2>&1
"
