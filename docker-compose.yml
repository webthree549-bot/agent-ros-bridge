version: '3.8'

services:
  # Production bridge with ROS2
  ros2-bridge:
    build:
      context: .
      dockerfile: docker/Dockerfile
    image: agent-ros-bridge:latest
    container_name: agent-ros-bridge
    ports:
      - "8765:8765"    # WebSocket
      - "50051:50051"  # gRPC
    environment:
      - ROS_DOMAIN_ID=0
    volumes:
      - ./config:/app/config:ro
    command: ["python3", "run_bridge.py"]

  # Optional: TurtleBot4 simulator for testing
  turtlebot4-sim:
    image: ros:jazzy-desktop
    container_name: turtlebot4-sim
    profiles: ["sim"]
    environment:
      - ROS_DOMAIN_ID=0
      - DISPLAY=${DISPLAY:-:0}
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
    command: >
      bash -c "
        source /opt/ros/jazzy/setup.bash &&
        ros2 launch turtlebot4_gz_bringup turtlebot4_gz.launch.py
      "
