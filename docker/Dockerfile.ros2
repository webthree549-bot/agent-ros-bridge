# Agent ROS Bridge - ROS2 Jazzy Container  
FROM ros:jazzy-ros-base

# Install Python and dependencies
# Note: rclpy is already included in ros:jazzy-ros-base
RUN apt-get update && apt-get install -y \
    python3-pip \
    python3-venv \
    && rm -rf /var/lib/apt/lists/*

# Install Python packages
RUN pip3 install --break-system-packages \
    websockets>=11.0 \
    pyyaml>=6.0.1 \
    psutil>=5.9.5 \
    python-dotenv>=1.0.0

# Set up workspace
WORKDIR /app

# Copy and install the package
COPY . /app/
RUN pip3 install --break-system-packages -e .

# Source ROS2 on startup
RUN echo "source /opt/ros/jazzy/setup.bash" >> ~/.bashrc
ENV ROS_DISTRO=jazzy

# Default: run production bridge
CMD ["python3", "run_bridge.py"]
